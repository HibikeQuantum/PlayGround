# 유닉스 고급 쉘에 나오는 운영팁

#Devops/language/Bash #Book #project

---

1. `cp` 같은걸 사용하는 배치를 작성을 할때 항상 --verbose 옵션을 사용하기를 권장. 어차피 로그를 열어볼일은 잘 없지만, 열어보게 될 일이 생길땐 최대한 자세한 내용을 원한게 될테니까 말이다.

2. 배치쉘이 1초간에 같은 이름으로 여러 파일을 작성가능성이 있다. 이에 대한 예외 처리를 통해 이름 뒤에 시퀀스를 붙이거나 천천히 실행하도록 조치를 해야한다.

3. 파일시스템에 대한 염려없이 일단 로그를 저장하게 만든 시스템이 다운되는 경우가 많다.  그래서 운영을 할때 파일이 자동으로 증가하는 영역이 있다면 미리 삭제하는 배치작업을 만들어놓는게 매너.

4. `rm -rf $tmpDir/` 이렇게 코드를 짰는데 $tmpDir 에 참조할 변수가 없으면 `rm -rf /`		이 된다. 정말 조심 이런 에러를 막기위해 set -u 를 하면 참조실패할때 스크립트를 종료시켜버리는 기능이 존재한다.  → Shell option

5. 웹서버를 공격할때 RFC(Request for Comments)를 위반한 요청이 온다. (RFC에 기반하여 HTML 프로토콜이 작성되었다) 그러면 첫번째 요청의 헤드가 이상하게 온다. (그럼 웹 서비스 로그도 이상하게 남겠지) 그래서 로그를 감시할때 좀 예외케이스를 주의할 필요가 있다.  광 범위하게 500번대 에러를 돌려주는 리퀘스트를 필터링 하려면 awk ‘$NF-1) >= 500 {print $}

6. 간단한 연산은 awk에서 진행한 다음 출력 할 수 있다. 1) 컬럼의 위치를 바꾸것나 2) 특정 값만 처리하기 

7. txt 파일을 브라우저로 보고 싶을땐 html 형식으로 바꿔야하는데.  이스케이프 문자로 변환을 해주는 작업을 해야한다. 쉘로 할 수도 있고 스크립트 언어에도 전용 함수가 있다. 반대로 html 

8. html 파일을 다루게 되면 이게 어떤 인코딩을 쓰는지 meta 값을 sed + iconv 로 컨버트 하는 과정이 필요하다. 메타값이 없으면 UTF-8이 기본이다.

9. `trap 'echo “Try Count: $count”’ USR1` 이렇게 USR1 sig를 받으면 안에서 변수를 출력하는 구조를 통해 쉘을  프로그램 처럼 더 독립적이고 인터렉티브하게 쓸 수 있다. 항상 포어그라운드로만 쓴다고 생각할 필요는 없다. 이건 설정 파일을 다시 읽게하는데도 쓸 수 있다. `trap ‘loadconf’ HUP`

10. 외부 파일을 읽는데

---